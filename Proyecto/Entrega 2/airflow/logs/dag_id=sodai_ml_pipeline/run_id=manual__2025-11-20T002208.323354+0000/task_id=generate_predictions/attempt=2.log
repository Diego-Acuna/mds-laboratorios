[2025-11-20T00:45:15.254+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2025-11-20T00:45:15.284+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: sodai_ml_pipeline.generate_predictions manual__2025-11-20T00:22:08.323354+00:00 [queued]>
[2025-11-20T00:45:15.290+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: sodai_ml_pipeline.generate_predictions manual__2025-11-20T00:22:08.323354+00:00 [queued]>
[2025-11-20T00:45:15.290+0000] {taskinstance.py:2306} INFO - Starting attempt 2 of 2
[2025-11-20T00:45:15.299+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): generate_predictions> on 2025-11-20 00:22:08.323354+00:00
[2025-11-20T00:45:15.307+0000] {standard_task_runner.py:64} INFO - Started process 1361 to run task
[2025-11-20T00:45:15.310+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'sodai_ml_pipeline', 'generate_predictions', 'manual__2025-11-20T00:22:08.323354+00:00', '--job-id', '187', '--raw', '--subdir', 'DAGS_FOLDER/sodai_ml_pipeline_dag.py', '--cfg-path', '/tmp/tmpuf65gv2w']
[2025-11-20T00:45:15.312+0000] {standard_task_runner.py:91} INFO - Job 187: Subtask generate_predictions
[2025-11-20T00:45:15.362+0000] {task_command.py:426} INFO - Running <TaskInstance: sodai_ml_pipeline.generate_predictions manual__2025-11-20T00:22:08.323354+00:00 [running]> on host 9937dd56ecd4
[2025-11-20T00:45:15.423+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='deep_drinkers' AIRFLOW_CTX_DAG_ID='sodai_ml_pipeline' AIRFLOW_CTX_TASK_ID='generate_predictions' AIRFLOW_CTX_EXECUTION_DATE='2025-11-20T00:22:08.323354+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-11-20T00:22:08.323354+00:00'
[2025-11-20T00:45:15.424+0000] {taskinstance.py:430} INFO - ::endgroup::
[2025-11-20T00:47:32.471+0000] {logging_mixin.py:188} INFO - Error generating predictions with chosen artifacts: NotFittedError Estimator not fitted, call fit before exploiting the model.
[2025-11-20T00:47:32.472+0000] {logging_mixin.py:188} INFO - Attempting fallback to baseline artifacts...
[2025-11-20T00:49:46.141+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.11/site-packages/sklearn/base.py:442 InconsistentVersionWarning: Trying to unpickle estimator SimpleImputer from version 1.6.1 when using version 1.7.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
[2025-11-20T00:49:46.144+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.11/site-packages/sklearn/base.py:442 InconsistentVersionWarning: Trying to unpickle estimator RobustScaler from version 1.6.1 when using version 1.7.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
[2025-11-20T00:49:46.145+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.11/site-packages/sklearn/base.py:442 InconsistentVersionWarning: Trying to unpickle estimator Pipeline from version 1.6.1 when using version 1.7.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
[2025-11-20T00:49:46.147+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.11/site-packages/sklearn/base.py:442 InconsistentVersionWarning: Trying to unpickle estimator OneHotEncoder from version 1.6.1 when using version 1.7.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
[2025-11-20T00:49:46.153+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.11/site-packages/sklearn/base.py:442 InconsistentVersionWarning: Trying to unpickle estimator ColumnTransformer from version 1.6.1 when using version 1.7.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
[2025-11-20T00:49:46.249+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.11/site-packages/sklearn/base.py:442 InconsistentVersionWarning: Trying to unpickle estimator LabelEncoder from version 1.6.1 when using version 1.7.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
[2025-11-20T00:49:48.145+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2025-11-20T00:49:48.146+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/opt/airflow/sodai_core/inference.py", line 207, in score_candidates
    proba = model.predict_proba(X_for_model)[:, 1]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/lightgbm/sklearn.py", line 1627, in predict_proba
    result = super().predict(
             ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/lightgbm/sklearn.py", line 1106, in predict
    raise LGBMNotFittedError("Estimator not fitted, call fit before exploiting the model.")
sklearn.exceptions.NotFittedError: Estimator not fitted, call fit before exploiting the model.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/airflow/dags/sodai_ml_pipeline_dag.py", line 309, in generate_predictions_task
    preds_path = inference.generate_weekly_predictions(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/sodai_core/inference.py", line 469, in generate_weekly_predictions
    scored = score_candidates(candidates, preprocess, model)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/sodai_core/inference.py", line 210, in score_candidates
    proba = model.predict_proba(X_trans)[:, 1]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/lightgbm/sklearn.py", line 1627, in predict_proba
    result = super().predict(
             ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/lightgbm/sklearn.py", line 1106, in predict
    raise LGBMNotFittedError("Estimator not fitted, call fit before exploiting the model.")
sklearn.exceptions.NotFittedError: Estimator not fitted, call fit before exploiting the model.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/sodai_ml_pipeline_dag.py", line 330, in generate_predictions_task
    preds_path = inference.generate_weekly_predictions(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/sodai_core/inference.py", line 469, in generate_weekly_predictions
    scored = score_candidates(candidates, preprocess, model)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/sodai_core/inference.py", line 200, in score_candidates
    X_trans = preprocess.transform(X)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/utils/_set_output.py", line 316, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/compose/_column_transformer.py", line 1096, in transform
    Xs = self._call_func_on_transformers(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/compose/_column_transformer.py", line 897, in _call_func_on_transformers
    return Parallel(n_jobs=self.n_jobs)(jobs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/utils/parallel.py", line 82, in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/joblib/parallel.py", line 1986, in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/joblib/parallel.py", line 1914, in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/utils/parallel.py", line 147, in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/pipeline.py", line 1520, in _transform_one
    res = transformer.transform(X, **params.transform)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/utils/_set_output.py", line 316, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/preprocessing/_encoders.py", line 1043, in transform
    X_int, X_mask = self._transform(
                    ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/preprocessing/_encoders.py", line 210, in _transform
    diff, valid_mask = _check_unknown(Xi, self.categories_[i], return_mask=True)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/sklearn/utils/_encode.py", line 313, in _check_unknown
    if xp.any(xp.isnan(known_values)):
              ^^^^^^^^^^^^^^^^^^^^^^
TypeError: ufunc 'isnan' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[2025-11-20T00:49:48.167+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=sodai_ml_pipeline, task_id=generate_predictions, run_id=manual__2025-11-20T00:22:08.323354+00:00, execution_date=20251120T002208, start_date=20251120T004515, end_date=20251120T004948
[2025-11-20T00:49:48.181+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 187 for task generate_predictions (ufunc 'isnan' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''; 1361)
[2025-11-20T00:49:48.257+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2025-11-20T00:49:48.287+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-11-20T00:49:48.291+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
